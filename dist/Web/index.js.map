{"version":3,"sources":["Web/index.js"],"names":["Client","require","express","cookies","morgan","path","cors","app","client","id","process","env","CLIENT_ID","secret","CLIENT_SECRET","redirectURI","scopes","use","json","urlencoded","extended","text","static","join","__dirname","set","get","async","req","res","key","render","data","getUser","_","redirect","authCodeLink","url","getAccess","query","code","toString","cookie","clearCookie","undefined","module","exports","listen","PORT","console","log"],"mappings":"AAAA,MAAMA,OAAEA,QAAWC,QAAQ,cACrBC,QAAUD,QAAQ,WAClBE,QAAUF,QAAQ,WAClBG,OAASH,QAAQ,UACjBI,KAAOJ,QAAQ,QACfK,KAAOL,QAAQ,QAEfM,IAAML,UACNM,OAAS,IAAIR,OAAO,CACzBS,GAAIC,QAAQC,IAAIC,UAChBC,OAAQH,QAAQC,IAAIG,cACpBC,YAAa,yDACbC,OAAQ,CAAC,cAGVT,IAAIU,IAAIX,QACRC,IAAIU,IAAIf,QAAQgB,QAChBX,IAAIU,IAAIf,QAAQiB,WAAW,CAAEC,UAAU,KACvCb,IAAIU,IAAIf,QAAQmB,QAChBd,IAAIU,IAAId,QAAQD,QAAQ,CAAC,IAAK,QAAS,QAAS,eAChDK,IAAIU,IAAIb,OAAO,aACfG,IAAIU,IAAI,UAAWf,QAAQoB,OAAOjB,KAAKkB,KAAKC,UAAW,YAEvDjB,IAAIkB,IAAI,cAAe,OACvBlB,IAAIkB,IAAI,eAAe,GACvBlB,IAAIkB,IAAI,cAAe,GACvBlB,IAAIkB,IAAI,QAASpB,KAAKkB,KAAKC,UAAW,UAEtCjB,IAAImB,IAAI,KAAKC,MAAOC,EAAKC,KACxB,MAAMC,EAAMF,EAAIzB,QAAQuB,IAAI,gBAE5BG,EAAIE,OAAO,QAAS,CAAEC,KAAMF,QAAYtB,OAAOyB,QAAQH,GAAO,UAG/DvB,IAAImB,IAAI,eAAe,CAACQ,EAAGL,IAAQA,EAAIM,SAAS,IAAK3B,OAAO4B,aAAaC,OAEzE9B,IAAImB,IAAI,kBAAkBC,MAAOC,EAAKC,KACrC,MAAMC,QAAYtB,OAAO8B,UAAUV,EAAIW,MAAMC,KAAKC,YAElDZ,EAAIa,OAAO,eAAgBZ,GAAKK,SAAS,QAG1C5B,IAAImB,IAAI,gBAAgB,CAACQ,EAAGL,KAC3BA,EAAIc,YAAY,oBAAgBC,GAEhCf,EAAIM,SAAS,IAAK,QAGnBU,OAAOC,QAAU,IAAMvC,IAAIwC,OAAOrC,QAAQC,IAAIqC,MAAM,IAAMC,QAAQC,IAAI","file":"index.js","sourcesContent":["const { Client } = require('@2pg/oauth');\nconst express = require('express');\nconst cookies = require('cookies');\nconst morgan = require('morgan');\nconst path = require('path');\nconst cors = require('cors');\n\nconst app = express();\nconst client = new Client({\n\tid: process.env.CLIENT_ID,\n\tsecret: process.env.CLIENT_SECRET,\n\tredirectURI: 'https://tanaka-production.up.railway.app/auth/callback',\n\tscopes: ['identify'],\n});\n\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\napp.use(express.text());\napp.use(cookies.express(['I', 'store', 'login', 'sessions.']));\napp.use(morgan('combined'));\napp.use('/static', express.static(path.join(__dirname, 'static')));\n\napp.set('view engine', 'ejs');\napp.set('trust proxy', true);\napp.set('json spaces', 8);\napp.set('views', path.join(__dirname, 'views'));\n\napp.get('/', async (req, res) => {\n\tconst key = req.cookies.get('discordToken');\n\n\tres.render('index', { data: key ? await client.getUser(key) : null });\n});\n\napp.get('/auth/login', (_, res) => res.redirect(302, client.authCodeLink.url));\n\napp.get('/auth/callback', async (req, res) => {\n\tconst key = await client.getAccess(req.query.code.toString());\n\n\tres.cookie('discordToken', key).redirect('/');\n});\n\napp.get('/auth/logout', (_, res) => {\n\tres.clearCookie('discordToken', undefined);\n\n\tres.redirect(302, '/');\n});\n\nmodule.exports = () => app.listen(process.env.PORT, () => console.log('Website is ready!'));\n"]}