{"version":3,"sources":["Web/index.js"],"names":["OAuthClient","require","express","morgan","path","cors","app","client","process","env","CLIENT_ID","CLIENT_SECRET","setRedirect","setScopes","uri","use","json","urlencoded","extended","text","set","join","__dirname","get","async","req","res","user","cookies","discordToken","status","render","data","redirect","accessCode","query","code","accessToken","getAccess","cookie","maxAge","_","module","exports","listen","PORT","console","log"],"mappings":"AAAA,MAAMA,YAAcC,QAAQ,eACtBC,QAAUD,QAAQ,WAClBE,OAASF,QAAQ,UACjBG,KAAOH,QAAQ,QACfI,KAAOJ,QAAQ,QAEfK,IAAMJ,UACNK,OAAS,IAAIP,YAAYQ,QAAQC,IAAIC,UAAWF,QAAQC,IAAIE,eAChEC,YAAY,0DACZC,UAAU,YAENC,IACL,wLAEDR,IAAIS,IAAIV,QACRC,IAAIS,IAAIb,QAAQc,QAChBV,IAAIS,IAAIb,QAAQe,WAAW,CAAEC,UAAU,KACvCZ,IAAIS,IAAIb,QAAQiB,QAChBb,IAAIS,IAAIZ,OAAO,aAEfG,IAAIc,IAAI,cAAe,OACvBd,IAAIc,IAAI,eAAe,GACvBd,IAAIc,IAAI,cAAe,GACvBd,IAAIc,IAAI,QAAShB,KAAKiB,KAAKC,UAAW,UAEtChB,IAAIiB,IAAI,KAAKC,MAAOC,EAAKC,KACxB,MAAMC,QAAcF,EAAIG,QAAQC,cAAiB,KAEjD,OAAOH,EAAII,OAAO,KAAKC,OAAO,QAAS,CAAEC,KAAML,OAGhDrB,IAAIiB,IAAI,eAAe,CAACE,EAAKC,IACxBD,EAAIG,QAAQC,aAAqBH,EAAIO,SAAS,IAAK,KAEhDP,EAAIO,SAAS,IAAKnB,OAG1BR,IAAIiB,IAAI,kBAAkBC,MAAOC,EAAKC,KACrC,GAAID,EAAIG,QAAQC,aAAc,OAAOH,EAAIO,SAAS,IAAK,KAEvD,MAAMC,EAAaT,EAAIU,MAAMC,KACvBC,QAAoB9B,OAAO+B,UAAUJ,GAI3C,OAFAR,EAAIa,OAAO,eAAgBF,EAAa,CAAEG,OAAQ,SAE3Cd,EAAIO,SAAS,IAAK,QAG1B3B,IAAIiB,IAAI,gBAAgB,CAACkB,EAAGf,KAC3BA,EAAIa,OAAO,eAAgB,KAAM,CAAEC,QAAS,IAErCd,EAAIO,SAAS,IAAK,QAG1BS,OAAOC,QAAU,IAAMrC,IAAIsC,OAAOpC,QAAQC,IAAIoC,MAAM,IAAMC,QAAQC,IAAI","file":"index.js","sourcesContent":["const OAuthClient = require('disco-oauth');\nconst express = require('express');\nconst morgan = require('morgan');\nconst path = require('path');\nconst cors = require('cors');\n\nconst app = express();\nconst client = new OAuthClient(process.env.CLIENT_ID, process.env.CLIENT_SECRET)\n\t.setRedirect('https://tanaka-production.up.railway.app/auth/callback')\n\t.setScopes('identify');\n\nconst uri =\n\t'https://discord.com/api/oauth2/authorize?client_id=804605929944645672&redirect_uri=https%3A%2F%2Ftanaka-production.up.railway.app%2Fauth%2Fcallback&response_type=code&scope=identify';\n\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\napp.use(express.text());\napp.use(morgan('combined'));\n\napp.set('view engine', 'ejs');\napp.set('trust proxy', true);\napp.set('json spaces', 8);\napp.set('views', path.join(__dirname, 'views'));\n\napp.get('/', async (req, res) => {\n\tconst user = (await req.cookies.discordToken) || null;\n\n\treturn res.status(200).render('index', { data: user });\n});\n\napp.get('/auth/login', (req, res) => {\n\tif (req.cookies.discordToken) return res.redirect(302, '/');\n\n\treturn res.redirect(302, uri);\n});\n\napp.get('/auth/callback', async (req, res) => {\n\tif (req.cookies.discordToken) return res.redirect(302, '/');\n\n\tconst accessCode = req.query.code;\n\tconst accessToken = await client.getAccess(accessCode);\n\n\tres.cookie('discordToken', accessToken, { maxAge: 604800000 });\n\n\treturn res.redirect(302, '/');\n});\n\napp.get('/auth/logout', (_, res) => {\n\tres.cookie('discordToken', null, { maxAge: -1 });\n\n\treturn res.redirect(302, '/');\n});\n\nmodule.exports = () => app.listen(process.env.PORT, () => console.log('Website is ready!'));\n"]}