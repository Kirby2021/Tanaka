const OAuthClient=require("disco-oauth"),express=require("express"),morgan=require("morgan"),path=require("path"),cors=require("cors"),app=express(),client=new OAuthClient(process.env.CLIENT_ID,process.env.CLIENT_SECRET).setRedirect("https://tanaka-production.up.railway.app/auth/callback").setScopes("identify"),uri="https://discord.com/api/oauth2/authorize?client_id=804605929944645672&redirect_uri=https%3A%2F%2Ftanaka-production.up.railway.app%2Fauth%2Fcallback&response_type=code&scope=identify";app.use(cors()),app.use(express.json()),app.use(express.urlencoded({extended:!0})),app.use(express.text()),app.use(morgan("combined")),app.set("view engine","ejs"),app.set("trust proxy",!0),app.set("json spaces",8),app.set("views",path.join(__dirname,"views")),app.get("/",(async(e,t)=>{const r=e.cookies.discordToken;return t.status(200).render("index",{data:await client.getUser(r)||null})})),app.get("/auth/login",((e,t)=>e.cookies.discordToken?t.redirect(302,"/"):t.redirect(302,uri))),app.get("/auth/callback",(async(e,t)=>{if(e.cookies.discordToken)return t.redirect(302,"/");const r=e.query.code,s=await client.getAccess(r);return t.cookie("discordToken",s,{maxAge:6048e5}),t.redirect(302,"/")})),app.get("/auth/logout",((e,t)=>(t.cookie("discordToken",null,{maxAge:-1}),t.redirect(302,"/")))),module.exports=app.listen;
//# sourceMappingURL=index.js.map
