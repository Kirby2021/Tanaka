const{Client:Client}=require("@2pg/oauth"),express=require("express"),cookies=require("cookies"),morgan=require("morgan"),path=require("path"),cors=require("cors"),app=express(),client=new Client({id:process.env.CLIENT_ID,secret:process.env.CLIENT_SECRET,redirectURI:"https://tanaka.1chi.tk/auth/callback",scopes:["identify","guilds.join"]});module.exports=e=>{app.use(cors()),app.use(express.json()),app.use(express.urlencoded({extended:!0})),app.use(express.text()),app.use(cookies.express(["I","store","login","sessions."])),app.use(morgan("combined")),app.use("/static",express.static(path.join(__dirname,"static"))),app.set("view engine","ejs"),app.set("trust proxy",!0),app.set("json spaces",8),app.set("views",path.join(__dirname,"views")),app.get("/",(async(s,t)=>{const i=s.cookies.get("discordToken"),o=e.guilds.cache.reduce(((e,s)=>e+s.memberCount),0).toLocaleString(),r=e.guilds.cache.size.toLocaleString(),a=e.channels.cache.size.toLocaleString(),n=e.registry.commands.size.toLocaleString(),c=e.shard?e.shard.count.toLocaleString():"1",p=Math.round(e.ws.ping);t.render("index",{data:i?await client.getUser(i):null,userCount:o,guildCount:r,channelCount:a,commandCount:n,shardCount:c,ping:p})})),app.get("/invite",((e,s)=>s.redirect(302,"https://discord.com/oauth2/authorize?client_id=804605929944645672&scope=bot&permissions=641064257"))),app.get("/commands",(async(e,s)=>{const t=e.cookies.get("discordToken");s.render("commands",{data:t?await client.getUser(t):null})})),app.get("/auth/login",((e,s)=>s.redirect(302,client.authCodeLink.url))),app.get("/auth/callback",(async(s,t)=>{if(s.cookies.get("discordToken"))return t.redirect(302,"/");const i=s.query.code.toString(),o=await client.getAccess(i),r=await client.getUser(o);await e.addGuildMember(o,r.id),t.cookie("discordToken",o).redirect("/")})),app.get("/auth/logout",((e,s)=>{s.clearCookie("discordToken",void 0),s.redirect(302,"/")})),app.listen(process.env.PORT||3e3,(()=>e.logger.info("Website is online!")))};
//# sourceMappingURL=index.js.map
