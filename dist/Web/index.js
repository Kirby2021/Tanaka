const{Client:Client}=require("@2pg/oauth"),express=require("express"),cookies=require("cookies"),morgan=require("morgan"),path=require("path"),cors=require("cors"),app=express(),client=new Client({id:process.env.CLIENT_ID,secret:process.env.CLIENT_SECRET,redirectURI:"https://tanaka-production.up.railway.app/auth/callback",scopes:["identify"]});module.exports=e=>{app.use(cors()),app.use(express.json()),app.use(express.urlencoded({extended:!0})),app.use(express.text()),app.use(cookies.express(["I","store","login","sessions."])),app.use(morgan("combined")),app.use("/static",express.static(path.join(__dirname,"static"))),app.set("view engine","ejs"),app.set("trust proxy",!0),app.set("json spaces",8),app.set("views",path.join(__dirname,"views")),app.get("/",(async(s,t)=>{const o=s.cookies.get("discordToken"),r=e.guilds.cache.reduce(((e,s)=>e+s.memberCount),0).toLocaleString(),i=e.guilds.cache.size.toLocaleString(),n=e.channels.cache.size.toLocaleString(),a=e.registry.commands.size.toLocaleString(),c=e.shard.count.toLocaleString(),p=Math.round(e.ws.ping);t.render("index",{data:o?await client.getUser(o):null,userCount:r,guildCount:i,channelCount:n,commandCount:a,shardCount:c,ping:p})})),app.get("/commands",(async(e,s)=>{const t=e.cookies.get("discordToken");s.render("commands",{data:t?await client.getUser(t):null})})),app.get("/auth/login",((e,s)=>s.redirect(302,client.authCodeLink.url))),app.get("/auth/callback",(async(e,s)=>{if(e.cookies.get("discordToken"))return s.redirect(302,"/");const t=await client.getAccess(e.query.code.toString());s.cookie("discordToken",t).redirect("/")})),app.get("/auth/logout",((e,s)=>{s.clearCookie("discordToken",void 0),s.redirect(302,"/")})),app.listen(process.env.PORT,(()=>e.logger.info("Website is online!")))};
//# sourceMappingURL=index.js.map
