{"version":3,"sources":["Commands/img/triggered.js"],"names":["createCanvas","loadImage","require","Command","request","GIFEncoder","path","module","exports","[object Object]","client","super","name","group","memberName","description","throttling","usages","duration","clientPermissions","args","key","prompt","type","default","msg","author","displayAvatarURL","format","size","image","body","get","base","join","__dirname","img","GIF","start","setRepeat","setDelay","ctx","getContext","BR","LR","i","clearRect","drawImage","Math","floor","random","fillStyle","fillRect","addFrame","finish","attachment","out","getData","Buffer","byteLength","reply","say","files","err","message"],"mappings":"AAAA,MAAMA,aAAEA,aAAYC,UAAEA,WAAcC,QAAQ,WACtCC,QAAEA,SAAYD,QAAQ,uBACtBE,QAAUF,QAAQ,mBAClBG,WAAaH,QAAQ,cACrBI,KAAOJ,QAAQ,QAErBK,OAAOC,QAAU,cAA+BL,QAC/CM,YAAYC,GACXC,MAAMD,EAAQ,CACbE,KAAM,YACNC,MAAO,MACPC,WAAY,YACZC,YAAa,4CACbC,WAAY,CACXC,OAAQ,EACRC,SAAU,IAEXC,kBAAmB,CAAC,gBACpBC,KAAM,CACL,CACCC,IAAK,QACLC,OAAQ,qCACRC,KAAM,QACNC,QAAUC,GAAQA,EAAIC,OAAOC,iBAAiB,CAAEC,OAAQ,MAAOC,KAAM,WAMzEpB,UAAUgB,GAAKK,MAAEA,IAChB,IACC,MAAMC,KAAEA,SAAe3B,QAAQ4B,IAAIF,GAC7BG,QAAahC,UAClBK,KAAK4B,KAAKC,UAAW,KAAM,KAAM,SAAU,QAAS,kBAE/CC,QAAYnC,UAAU8B,GACtBM,EAAM,IAAIhC,WAAW,IAAK,KAEhCgC,EAAIC,QACJD,EAAIE,UAAU,GACdF,EAAIG,SAAS,IAEb,MACMC,EADSzC,aAAa,IAAK,KACd0C,WAAW,MACxBC,EAAK,GACLC,EAAK,GAEX,IAAIC,EAAI,EAER,KAAOA,EAAI,GACVJ,EAAIK,UAAU,EAAG,EAAG,IAAK,KACzBL,EAAIM,UACHX,EACAY,KAAKC,MAAMD,KAAKE,SAAWP,GAAMA,EACjCK,KAAKC,MAAMD,KAAKE,SAAWP,GAAMA,EACjC,IAAMA,EACN,IAAWA,GAEZF,EAAIU,UAAY,aAChBV,EAAIW,SAAS,EAAG,EAAG,IAAK,KACxBX,EAAIM,UACHd,EACAe,KAAKC,MAAMD,KAAKE,SAAWN,GAAMA,EACjC,IAAWI,KAAKC,MAAMD,KAAKE,SAAWN,GAAMA,EAC5C,IAAMA,EACN,GAAKA,GAGNP,EAAIgB,SAASZ,GAEbI,IAEDR,EAAIiB,SAEJ,MAAMC,EAAalB,EAAImB,IAAIC,UAE3B,OAAIC,OAAOC,WAAWJ,GAAc,IAAY9B,EAAImC,MAAM,mCAEnDnC,EAAIoC,IAAI,CAAEC,MAAO,CAAC,CAAEP,WAAAA,EAAY3C,KAAM,oBAC5C,MAAOmD,GACR,OAAOtC,EAAImC,MAAM,uBAAuBG,EAAIC","file":"triggered.js","sourcesContent":["const { createCanvas, loadImage } = require('canvas');\nconst { Command } = require('discord.js-commando');\nconst request = require('node-superfetch');\nconst GIFEncoder = require('gifencoder');\nconst path = require('path');\n\nmodule.exports = class TriggeredCommand extends Command {\n\tconstructor(client) {\n\t\tsuper(client, {\n\t\t\tname: 'triggered',\n\t\t\tgroup: 'img',\n\t\t\tmemberName: 'triggered',\n\t\t\tdescription: 'Applies the triggered effect to an image.',\n\t\t\tthrottling: {\n\t\t\t\tusages: 1,\n\t\t\t\tduration: 10,\n\t\t\t},\n\t\t\tclientPermissions: ['ATTACH_FILES'],\n\t\t\targs: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'image',\n\t\t\t\t\tprompt: 'What image would you like to edit?',\n\t\t\t\t\ttype: 'image',\n\t\t\t\t\tdefault: (msg) => msg.author.displayAvatarURL({ format: 'png', size: 4096 }),\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\tasync run(msg, { image }) {\n\t\ttry {\n\t\t\tconst { body } = await request.get(image);\n\t\t\tconst base = await loadImage(\n\t\t\t\tpath.join(__dirname, '..', '..', 'Assets', 'image', 'triggered.png'),\n\t\t\t);\n\t\t\tconst img = await loadImage(body);\n\t\t\tconst GIF = new GIFEncoder(256, 310);\n\n\t\t\tGIF.start();\n\t\t\tGIF.setRepeat(0);\n\t\t\tGIF.setDelay(15);\n\n\t\t\tconst canvas = createCanvas(256, 310);\n\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\tconst BR = 30;\n\t\t\tconst LR = 20;\n\n\t\t\tlet i = 0;\n\n\t\t\twhile (i < 9) {\n\t\t\t\tctx.clearRect(0, 0, 256, 310);\n\t\t\t\tctx.drawImage(\n\t\t\t\t\timg,\n\t\t\t\t\tMath.floor(Math.random() * BR) - BR,\n\t\t\t\t\tMath.floor(Math.random() * BR) - BR,\n\t\t\t\t\t256 + BR,\n\t\t\t\t\t310 - 54 + BR,\n\t\t\t\t);\n\t\t\t\tctx.fillStyle = '##FF000033';\n\t\t\t\tctx.fillRect(0, 0, 256, 310);\n\t\t\t\tctx.drawImage(\n\t\t\t\t\tbase,\n\t\t\t\t\tMath.floor(Math.random() * LR) - LR,\n\t\t\t\t\t310 - 54 + Math.floor(Math.random() * LR) - LR,\n\t\t\t\t\t256 + LR,\n\t\t\t\t\t54 + LR,\n\t\t\t\t);\n\n\t\t\t\tGIF.addFrame(ctx);\n\n\t\t\t\ti++;\n\t\t\t}\n\t\t\tGIF.finish();\n\n\t\t\tconst attachment = GIF.out.getData();\n\n\t\t\tif (Buffer.byteLength(attachment) > 8e6) return msg.reply('Resulting image was above 8 MB.');\n\n\t\t\treturn msg.say({ files: [{ attachment, name: 'triggered.gif' }] });\n\t\t} catch (err) {\n\t\t\treturn msg.reply(`An error occured: \\`${err.message}\\`.`);\n\t\t}\n\t}\n};\n"]}