{"version":3,"sources":["Commands/img/triggered.js"],"names":["drawImageWithTint","require","streamToArray","createCanvas","loadImage","Command","request","GIFEncoder","path","coord1","coord2","module","exports","[object Object]","client","super","name","group","memberName","description","throttling","usages","duration","clientPermissions","args","key","prompt","type","default","msg","author","displayAvatarURL","format","size","image","base","join","__dirname","body","get","avatar","encoder","width","ctx","getContext","fillStyle","fillRect","stream","createReadStream","start","setRepeat","setDelay","setQuality","i","drawImage","addFrame","finish","buffer","say","files","attachment","Buffer","concat","err","reply","message"],"mappings":"AAAA,MAAMA,kBAAEA,mBAAsBC,QAAQ,4BAChCC,cAAEA,eAAkBD,QAAQ,0BAC5BE,aAAEA,aAAYC,UAAEA,WAAcH,QAAQ,WACtCI,QAAEA,SAAYJ,QAAQ,uBACtBK,QAAUL,QAAQ,mBAClBM,WAAaN,QAAQ,cACrBO,KAAOP,QAAQ,QAEfQ,OAAS,EAAE,IAAK,IAAK,IAAK,IAC1BC,OAAS,EAAE,IAAK,IAAK,IAAK,IAEhCC,OAAOC,QAAU,cAA+BP,QAC/CQ,YAAYC,GACXC,MAAMD,EAAQ,CACbE,KAAM,YACNC,MAAO,MACPC,WAAY,YACZC,YAAa,4CACbC,WAAY,CACXC,OAAQ,EACRC,SAAU,IAEXC,kBAAmB,CAAC,gBACpBC,KAAM,CACL,CACCC,IAAK,QACLC,OAAQ,qCACRC,KAAM,QACNC,QAAUC,GAAQA,EAAIC,OAAOC,iBAAiB,CAAEC,OAAQ,MAAOC,KAAM,UAMzEpB,UAAUgB,GAAKK,MAAEA,IAChB,IACC,MAAMC,QAAa/B,UAClBI,KAAK4B,KAAKC,UAAW,KAAM,KAAM,SAAU,QAAS,mBAE/CC,KAAEA,SAAehC,QAAQiC,IAAIL,GAC7BM,QAAepC,UAAUkC,GACzBG,EAAU,IAAIlC,WAAW4B,EAAKO,MAAOP,EAAKO,OAE1CC,EADSxC,aAAagC,EAAKO,MAAOP,EAAKO,OAC1BE,WAAW,MAE9BD,EAAIE,UAAY,QAChBF,EAAIG,SAAS,EAAG,EAAGX,EAAKO,MAAOP,EAAKO,OAEpC,MAAMK,EAASN,EAAQO,mBAEvBP,EAAQQ,QACRR,EAAQS,UAAU,GAClBT,EAAQU,SAAS,IACjBV,EAAQW,WAAW,KAEnB,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IACtBrD,kBAAkB2C,EAAKH,EAAQ,MAAO/B,OAAO4C,GAAI3C,OAAO2C,GAAI,IAAK,KACjEV,EAAIW,UAAUnB,EAAM,EAAG,IAAK,IAAK,IACjCM,EAAQc,SAASZ,GAGlBF,EAAQe,SAER,MAAMC,QAAevD,cAAc6C,GAEnC,OAAOlB,EAAI6B,IAAI,CAAEC,MAAO,CAAC,CAAEC,WAAYC,OAAOC,OAAOL,GAASzC,KAAM,oBACnE,MAAO+C,GACR,OAAOlC,EAAImC,MAAM,uBAAuBD,EAAIE","file":"triggered.js","sourcesContent":["const { drawImageWithTint } = require('../../Structures/Canvas');\nconst { streamToArray } = require('../../Structures/Util');\nconst { createCanvas, loadImage } = require('canvas');\nconst { Command } = require('discord.js-commando');\nconst request = require('node-superfetch');\nconst GIFEncoder = require('gifencoder');\nconst path = require('path');\n\nconst coord1 = [-25, -33, -42, -14];\nconst coord2 = [-25, -13, -34, -10];\n\nmodule.exports = class TriggeredCommand extends Command {\n\tconstructor(client) {\n\t\tsuper(client, {\n\t\t\tname: 'triggered',\n\t\t\tgroup: 'img',\n\t\t\tmemberName: 'triggered',\n\t\t\tdescription: 'Applies the triggered effect to an image.',\n\t\t\tthrottling: {\n\t\t\t\tusages: 1,\n\t\t\t\tduration: 30,\n\t\t\t},\n\t\t\tclientPermissions: ['ATTACH_FILES'],\n\t\t\targs: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'image',\n\t\t\t\t\tprompt: 'What image would you like to edit?',\n\t\t\t\t\ttype: 'image',\n\t\t\t\t\tdefault: (msg) => msg.author.displayAvatarURL({ format: 'png', size: 512 }),\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\tasync run(msg, { image }) {\n\t\ttry {\n\t\t\tconst base = await loadImage(\n\t\t\t\tpath.join(__dirname, '..', '..', 'Assets', 'image', 'triggered.png'),\n\t\t\t);\n\t\t\tconst { body } = await request.get(image);\n\t\t\tconst avatar = await loadImage(body);\n\t\t\tconst encoder = new GIFEncoder(base.width, base.width);\n\t\t\tconst canvas = createCanvas(base.width, base.width);\n\t\t\tconst ctx = canvas.getContext('2d');\n\n\t\t\tctx.fillStyle = 'white';\n\t\t\tctx.fillRect(0, 0, base.width, base.width);\n\n\t\t\tconst stream = encoder.createReadStream();\n\n\t\t\tencoder.start();\n\t\t\tencoder.setRepeat(0);\n\t\t\tencoder.setDelay(50);\n\t\t\tencoder.setQuality(200);\n\n\t\t\tfor (let i = 0; i < 4; i++) {\n\t\t\t\tdrawImageWithTint(ctx, avatar, 'red', coord1[i], coord2[i], 300, 300);\n\t\t\t\tctx.drawImage(base, 0, 218, 256, 38);\n\t\t\t\tencoder.addFrame(ctx);\n\t\t\t}\n\n\t\t\tencoder.finish();\n\n\t\t\tconst buffer = await streamToArray(stream);\n\n\t\t\treturn msg.say({ files: [{ attachment: Buffer.concat(buffer), name: 'triggered.gif' }] });\n\t\t} catch (err) {\n\t\t\treturn msg.reply(`An error occured: \\`${err.message}\\`.`);\n\t\t}\n\t}\n};\n"]}