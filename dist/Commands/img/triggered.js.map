{"version":3,"sources":["Commands/img/triggered.js"],"names":["streamToArray","require","createCanvas","loadImage","Command","request","GIFEncoder","path","module","exports","[object Object]","client","super","name","group","memberName","description","throttling","usages","duration","clientPermissions","args","key","prompt","type","default","msg","author","displayAvatarURL","format","size","image","body","get","base","join","__dirname","img","GIF","stream","createReadStream","start","setRepeat","setDelay","ctx","getContext","BR","LR","i","clearRect","drawImage","Math","floor","random","fillStyle","fillRect","addFrame","finish","buffer","say","files","attachment","Buffer","concat","err","reply","message"],"mappings":"AAAA,MAAMA,cAAEA,eAAkBC,QAAQ,0BAC5BC,aAAEA,aAAYC,UAAEA,WAAcF,QAAQ,WACtCG,QAAEA,SAAYH,QAAQ,uBACtBI,QAAUJ,QAAQ,mBAClBK,WAAaL,QAAQ,cACrBM,KAAON,QAAQ,QAErBO,OAAOC,QAAU,cAA+BL,QAC/CM,YAAYC,GACXC,MAAMD,EAAQ,CACbE,KAAM,YACNC,MAAO,MACPC,WAAY,YACZC,YAAa,4CACbC,WAAY,CACXC,OAAQ,EACRC,SAAU,IAEXC,kBAAmB,CAAC,gBACpBC,KAAM,CACL,CACCC,IAAK,QACLC,OAAQ,qCACRC,KAAM,QACNC,QAAUC,GAAQA,EAAIC,OAAOC,iBAAiB,CAAEC,OAAQ,MAAOC,KAAM,UAMzEpB,UAAUgB,GAAKK,MAAEA,IAChB,IACC,MAAMC,KAAEA,SAAe3B,QAAQ4B,IAAIF,GAC7BG,QAAa/B,UAClBI,KAAK4B,KAAKC,UAAW,KAAM,KAAM,SAAU,QAAS,kBAE/CC,QAAYlC,UAAU6B,GACtBM,EAAM,IAAIhC,WAAW,IAAK,KAC1BiC,EAASD,EAAIE,mBAEnBF,EAAIG,QACJH,EAAII,UAAU,GACdJ,EAAIK,SAAS,IAEb,MACMC,EADS1C,aAAa,IAAK,KACd2C,WAAW,MACxBC,EAAK,GACLC,EAAK,GAEX,IAAIC,EAAI,EAER,KAAOA,EAAI,GACVJ,EAAIK,UAAU,EAAG,EAAG,IAAK,KACzBL,EAAIM,UACHb,EACAc,KAAKC,MAAMD,KAAKE,SAAWP,GAAMA,EACjCK,KAAKC,MAAMD,KAAKE,SAAWP,GAAMA,EACjC,IAAMA,EACN,IAAWA,GAEZF,EAAIU,UAAY,aAChBV,EAAIW,SAAS,EAAG,EAAG,IAAK,KACxBX,EAAIM,UACHhB,EACAiB,KAAKC,MAAMD,KAAKE,SAAWN,GAAMA,EACjC,IAAWI,KAAKC,MAAMD,KAAKE,SAAWN,GAAMA,EAC5C,IAAMA,EACN,GAAKA,GAGNT,EAAIkB,SAASZ,GAEbI,IAEDV,EAAImB,SAEJ,MAAMC,QAAe1D,cAAcuC,GAEnC,OAAOb,EAAIiC,IAAI,CAAEC,MAAO,CAAC,CAAEC,WAAYC,OAAOC,OAAOL,GAAS7C,KAAM,oBACnE,MAAOmD,GACR,OAAOtC,EAAIuC,MAAM,uBAAuBD,EAAIE","file":"triggered.js","sourcesContent":["const { streamToArray } = require('../../Structures/Util');\nconst { createCanvas, loadImage } = require('canvas');\nconst { Command } = require('discord.js-commando');\nconst request = require('node-superfetch');\nconst GIFEncoder = require('gifencoder');\nconst path = require('path');\n\nmodule.exports = class TriggeredCommand extends Command {\n\tconstructor(client) {\n\t\tsuper(client, {\n\t\t\tname: 'triggered',\n\t\t\tgroup: 'img',\n\t\t\tmemberName: 'triggered',\n\t\t\tdescription: 'Applies the triggered effect to an image.',\n\t\t\tthrottling: {\n\t\t\t\tusages: 1,\n\t\t\t\tduration: 10,\n\t\t\t},\n\t\t\tclientPermissions: ['ATTACH_FILES'],\n\t\t\targs: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'image',\n\t\t\t\t\tprompt: 'What image would you like to edit?',\n\t\t\t\t\ttype: 'image',\n\t\t\t\t\tdefault: (msg) => msg.author.displayAvatarURL({ format: 'png', size: 512 }),\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\tasync run(msg, { image }) {\n\t\ttry {\n\t\t\tconst { body } = await request.get(image);\n\t\t\tconst base = await loadImage(\n\t\t\t\tpath.join(__dirname, '..', '..', 'Assets', 'image', 'triggered.png'),\n\t\t\t);\n\t\t\tconst img = await loadImage(body);\n\t\t\tconst GIF = new GIFEncoder(256, 310);\n\t\t\tconst stream = GIF.createReadStream();\n\n\t\t\tGIF.start();\n\t\t\tGIF.setRepeat(0);\n\t\t\tGIF.setDelay(15);\n\n\t\t\tconst canvas = createCanvas(256, 310);\n\t\t\tconst ctx = canvas.getContext('2d');\n\t\t\tconst BR = 30;\n\t\t\tconst LR = 20;\n\n\t\t\tlet i = 0;\n\n\t\t\twhile (i < 9) {\n\t\t\t\tctx.clearRect(0, 0, 256, 310);\n\t\t\t\tctx.drawImage(\n\t\t\t\t\timg,\n\t\t\t\t\tMath.floor(Math.random() * BR) - BR,\n\t\t\t\t\tMath.floor(Math.random() * BR) - BR,\n\t\t\t\t\t256 + BR,\n\t\t\t\t\t310 - 54 + BR,\n\t\t\t\t);\n\t\t\t\tctx.fillStyle = '##FF000033';\n\t\t\t\tctx.fillRect(0, 0, 256, 310);\n\t\t\t\tctx.drawImage(\n\t\t\t\t\tbase,\n\t\t\t\t\tMath.floor(Math.random() * LR) - LR,\n\t\t\t\t\t310 - 54 + Math.floor(Math.random() * LR) - LR,\n\t\t\t\t\t256 + LR,\n\t\t\t\t\t54 + LR,\n\t\t\t\t);\n\n\t\t\t\tGIF.addFrame(ctx);\n\n\t\t\t\ti++;\n\t\t\t}\n\t\t\tGIF.finish();\n\n\t\t\tconst buffer = await streamToArray(stream);\n\n\t\t\treturn msg.say({ files: [{ attachment: Buffer.concat(buffer), name: 'triggered.gif' }] });\n\t\t} catch (err) {\n\t\t\treturn msg.reply(`An error occured: \\`${err.message}\\`.`);\n\t\t}\n\t}\n};\n"]}