const{Command:Command}=require("discord.js-commando"),{MessageEmbed:MessageEmbed}=require("discord.js");module.exports=class extends Command{constructor(e){super(e,{name:"play",aliases:["play-music","p"],group:"music",memberName:"play",description:"Add's music to the music queue.",guildOnly:!0,args:[{key:"title",prompt:"What is the title of the music?",type:"string"}]})}async run(e,{title:t}){const{channel:s}=e.member.voice;if(!s)return e.reply("You need to join a voice channel!");const r=this.client.manager.create({guild:e.guild.id,voiceChannel:s.id,textChannel:e.channel.id,selfDeafen:!0});let a;"CONNECTED"!==r.state&&r.connect();try{if(a=await r.search(t,e.author),"LOAD_FAILED"===a.loadType)throw r.queue.current||r.destroy(),a.exception}catch(t){return e.reply(`There was an error while searching: ${t.message}.`)}switch(a.loadType){case"NO_MATCHES":return r.queue.current||r.destroy(),e.reply("There were no results found.");case"TRACK_LOADED":{r.queue.add(a.tracks[0]);const t=a.tracks[0];r.playing||r.paused||r.queue.size||r.play();const s=(new MessageEmbed).setTitle(`**Adding to queue: __${t.title}__**`).setURL(t.uri).setImage(t.thumbnail||"").setAuthor(t.author).setColor("RANDOM").setFooter(`Requested by: ${t.requester.tag}`).setTimestamp();return e.reply(s)}case"PLAYLIST_LOADED":return r.queue.add(a.tracks),r.playing||r.paused||r.queue.totalSize!==a.tracks.length||r.play(),e.reply(`Queuing playlist \`${a.playlist.name}\` with ${a.tracks.length} tracks.`);case"SEARCH_RESULT":{let t,s=5;const n=t=>t.author.id===e.author.id&&/^(\d+|end)$/i.test(t.content);a.tracks.length<s&&(s=a.tracks.length);const o=(new MessageEmbed).setTitle("Reply with a number.").setDescription(a.tracks.slice(0,s).map(((e,t)=>`${++t} - \`${e.title}\``)).join("\n")).setColor("RANDOM").setFooter('Reply with "end" to cancel').setTimestamp();e.say(o);try{t=await e.channel.awaitMessages(n,{max:1,time:3e4,errors:["time"]})}catch(t){return r.queue.current||r.destroy(),e.reply("You didn't provide a selection.")}const i=t.first().content;if("end"===i.toLowerCase())return r.queue.current||r.destroy(),e.say("Cancelled selection.");const u=Number(i)-1;if(u<0||u>s-1)return e.say(`The number you provided is too small or too big (1-${s}).`);const c=a.tracks[u];r.queue.add(c),r.playing||r.paused||r.queue.size||r.play();const l=(new MessageEmbed).setTitle(`**Adding to queue: __${c.title}__**`).setURL(c.uri).setImage(c.thumbnail||"").setAuthor(c.author).setColor("RANDOM").setFooter(`Requested by: ${c.requester.tag}`).setTimestamp();return e.reply(l)}}}};
//# sourceMappingURL=play.js.map
