{"version":3,"sources":["Structures/Client.js"],"names":["Intents","WebhookClient","Collection","require","MongoDBProvider","CommandoClient","FeedEmitter","TimerManager","execSync","MongoClient","Database","Manager","OpenEval","glob","Turndown","BotList","logger","Redis","web","path","module","exports","[object Object]","options","super","commandPrefix","process","env","COMMAND_PREFIX","owner","OWNER_ID","intents","NON_PRIVILEGED","FLAGS","GUILDS","partials","allowedMentions","repliedUser","this","db","MONGO_URI","useNewUrlParser","useUnifiedTopology","rss","testWebhook","TEST_WEBHOOK_ID","TEST_WEBHOOK_TOKEN","redis","timers","converter","bl","client","manager","send","id","payload","guild","guilds","cache","get","shard","events","piston","ip","timeout","encoding","directory","dirname","main","filename","sep","broadcastEval","reduce","a","b","memberCount","fetchClientValues","size","channels","token","DISCORD_TOKEN","addRSSListeners","registerCommands","loadEvents","registerProvider","login","eventFile","event","set","name","emitter","type","args","run","url","refresh","eventName","ignoreFirst","forEach","feed","add","registry","groups","map","g","commands","filter","c","hidden","extra","ownerOnly","nsfw","description","join","registerDefaultTypes","registerGroups","guarded","registerDefaultGroups","registerDefaultCommands","unknownCommand","help","eval","ping","commandState","prefix","registerTypesIn","__dirname","registerCommandsIn","mongo","connect","setProvider"],"mappings":"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","file":"Client.js","sourcesContent":["const { Intents, WebhookClient, Collection } = require('discord.js');\nconst { MongoDBProvider } = require('commando-provider-mongo');\nconst { CommandoClient } = require('discord.js-commando');\nconst { FeedEmitter } = require('rss-emitter-ts');\nconst TimerManager = require('./TimerManager');\nconst { execSync } = require('child_process');\nconst { MongoClient } = require('mongodb');\nconst { Database } = require('quickmongo');\nconst { Manager } = require('erela.js');\nconst OpenEval = require('open-eval');\nconst glob = require('glob-promise');\nconst Turndown = require('turndown');\nconst BotList = require('./BotList');\nconst logger = require('./Logger');\nconst Redis = require('./Redis');\nconst web = require('../Web');\nconst path = require('path');\n\nmodule.exports = class Client extends CommandoClient {\n\tconstructor(options) {\n\t\tsuper({\n\t\t\tcommandPrefix: process.env.COMMAND_PREFIX,\n\t\t\towner: process.env.OWNER_ID,\n\t\t\tintents: [Intents.NON_PRIVILEGED, Intents.FLAGS.GUILDS],\n\t\t\tpartials: ['CHANNEL'],\n\t\t\tallowedMentions: {\n\t\t\t\trepliedUser: false,\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\n\t\tthis.db = new Database(process.env.MONGO_URI, 'tanaka', {\n\t\t\tuseNewUrlParser: true,\n\t\t\tuseUnifiedTopology: true,\n\t\t});\n\n\t\tthis.logger = logger;\n\n\t\tthis.rss = new FeedEmitter();\n\n\t\tthis.testWebhook = new WebhookClient(process.env.TEST_WEBHOOK_ID, process.env.TEST_WEBHOOK_TOKEN);\n\n\t\tthis.redis = new Redis(this).db;\n\n\t\tthis.timers = new TimerManager(this);\n\n\t\tthis.converter = new Turndown();\n\n\t\tthis.bl = new BotList(this);\n\n\t\tthis.client = this;\n\n\t\tthis.manager = new Manager({\n\t\t\tsend: (id, payload) => {\n\t\t\t\tconst guild = this.guilds.cache.get(id);\n\n\t\t\t\tif (guild) guild.shard.send(payload);\n\t\t\t},\n\t\t});\n\n\t\tthis.events = new Collection();\n\n\t\tthis.piston = new OpenEval();\n\t}\n\n\tget ip() {\n\t\tconst ip = execSync('curl https://ipecho.net/plain', { timeout: 30000, encoding: 'utf-8' });\n\t\treturn ip;\n\t}\n\n\tget directory() {\n\t\treturn `${path.dirname(require.main.filename)}${path.sep}`;\n\t}\n\n\tasync userCount() {\n\t\tif (this.shard) {\n\t\t\tconst count = await this.shard.broadcastEval(\n\t\t\t\t'this.guilds.cache.reduce((a, b) => a + b.memberCount, 0)',\n\t\t\t);\n\n\t\t\treturn count.reduce((a, b) => a + b, 0);\n\t\t}\n\n\t\treturn this.guilds.cache.reduce((a, b) => a + b.memberCount, 0);\n\t}\n\n\tasync guildCount() {\n\t\tif (this.shard) {\n\t\t\tconst count = await this.shard.fetchClientValues('guilds.cache.size');\n\n\t\t\treturn count.reduce((a, b) => a + b, 0);\n\t\t}\n\n\t\treturn this.guilds.cache.size;\n\t}\n\n\tasync channelCount() {\n\t\tif (this.shard) {\n\t\t\tconst count = await this.shard.fetchClientValues('channels.cache.size');\n\n\t\t\treturn count.reduce((a, b) => a + b, 0);\n\t\t}\n\n\t\treturn this.channels.cache.size;\n\t}\n\n\tasync login(token = process.env.DISCORD_TOKEN) {\n\t\tthis.addRSSListeners();\n\t\tthis.registerCommands();\n\t\tweb(this);\n\n\t\tawait this.loadEvents();\n\t\tawait this.registerProvider();\n\n\t\treturn super.login(token);\n\t}\n\n\tasync loadEvents() {\n\t\tconst events = await glob(`${this.directory}Events/**/*.js`);\n\n\t\tfor (const eventFile of events) {\n\t\t\tdelete require.cache[eventFile];\n\n\t\t\tconst File = require(eventFile);\n\t\t\tconst event = new File(this.client);\n\n\t\t\tthis.events.set(event.name, event);\n\t\t\tevent.emitter[event.type](event.name, (...args) => event.run(...args));\n\t\t}\n\t}\n\n\taddRSSListeners() {\n\t\tconst feeds = [\n\t\t\t{\n\t\t\t\turl: 'https://www.animenewsnetwork.com/all/rss.xml?ann-edition=us',\n\t\t\t\trefresh: 20000,\n\t\t\t\teventName: 'anime',\n\t\t\t\tignoreFirst: true,\n\t\t\t},\n\t\t];\n\n\t\tfeeds.forEach((feed) => this.rss.add(feed));\n\t}\n\n\tgenerateCommandList() {\n\t\tconst list = this.registry.groups\n\t\t\t.map((g) => {\n\t\t\t\tconst commands = g.commands.filter((c) => !c.hidden);\n\t\t\t\treturn `\\n<h3>${g.name}:</h3>\\n\\n<ul>${commands\n\t\t\t\t\t.map((c) => {\n\t\t\t\t\t\tconst extra = `${c.ownerOnly ? ' (Owner-Only)' : ''}${\n\t\t\t\t\t\t\tc.nsfw ? ' (NSFW)' : ''\n\t\t\t\t\t\t}`;\n\t\t\t\t\t\treturn `<li> <strong>${c.name}:</strong> ${c.description}${extra}</li>`;\n\t\t\t\t\t})\n\t\t\t\t\t.join('</ul>\\n')}`;\n\t\t\t})\n\t\t\t.join('\\n');\n\n\t\treturn list;\n\t}\n\n\tregisterCommands() {\n\t\tthis.client.registry\n\t\t\t.registerDefaultTypes()\n\t\t\t.registerGroups([\n\t\t\t\t{ id: 'util', name: 'Utility', guarded: true },\n\t\t\t\t{ id: 'random', name: 'Random Response' },\n\t\t\t\t{ id: 'info', name: 'Information' },\n\t\t\t\t{ id: 'search', name: 'Search' },\n\t\t\t\t{ id: 'remind', name: 'Reminder' },\n\t\t\t\t{ id: 'anime-updates', name: 'Anime Updates' },\n\t\t\t\t{ id: 'codebin', name: 'Code Bins' },\n\t\t\t\t{ id: 'img', name: 'Image Manipulation' },\n\t\t\t\t{ id: 'music', name: 'Music' },\n\t\t\t])\n\t\t\t.registerDefaultGroups()\n\t\t\t.registerDefaultCommands({\n\t\t\t\tunknownCommand: false,\n\t\t\t\thelp: false,\n\t\t\t\teval: false,\n\t\t\t\tping: false,\n\t\t\t\tcommandState: false,\n\t\t\t\tprefix: false,\n\t\t\t})\n\t\t\t.registerTypesIn(path.join(__dirname, '..', 'Types'))\n\t\t\t.registerCommandsIn(path.join(__dirname, '..', 'Commands'));\n\t}\n\n\tasync registerProvider() {\n\t\tconst mongo = await MongoClient.connect(process.env.MONGO_URI, {\n\t\t\tuseNewUrlParser: true,\n\t\t\tuseUnifiedTopology: true,\n\t\t});\n\n\t\tthis.setProvider(new MongoDBProvider(mongo, 'tanaka'));\n\t}\n};\n"]}