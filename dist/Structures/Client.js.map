{"version":3,"sources":["Structures/Client.js"],"names":["Intents","WebhookClient","Collection","require","MongoDBProvider","CommandoClient","TimerManager","execSync","MongoClient","Database","Manager","OpenEval","glob","Turndown","snoowrap","BotList","logger","Redis","web","path","module","exports","[object Object]","options","super","commandPrefix","process","env","COMMAND_PREFIX","owner","OWNER_ID","intents","NON_PRIVILEGED","FLAGS","GUILDS","partials","allowedMentions","repliedUser","parse","this","db","MONGO_URI","useNewUrlParser","useUnifiedTopology","testWebhook","TEST_WEBHOOK_ID","TEST_WEBHOOK_TOKEN","redis","timers","converter","bl","client","manager","send","id","payload","guild","guilds","cache","get","shard","events","piston","reddit","userAgent","clientId","REDDIT_CLIENT_ID","clientSecret","REDDIT_CLIENT_SECRET","username","password","REDDIT_PASSWORD","ip","timeout","encoding","directory","dirname","main","filename","sep","broadcastEval","reduce","a","b","memberCount","fetchClientValues","size","channels","token","DISCORD_TOKEN","registerCommands","loadEvents","registerProvider","login","eventFile","event","set","name","emitter","type","args","run","registry","groups","map","g","commands","filter","c","hidden","extra","ownerOnly","nsfw","description","join","registerDefaultTypes","registerGroups","guarded","registerDefaultGroups","registerDefaultCommands","unknownCommand","help","eval","ping","commandState","prefix","registerTypesIn","__dirname","registerCommandsIn","mongo","connect","setProvider"],"mappings":"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","file":"Client.js","sourcesContent":["const { Intents, WebhookClient, Collection } = require('discord.js');\nconst { MongoDBProvider } = require('commando-provider-mongo');\nconst { CommandoClient } = require('discord.js-commando');\nconst TimerManager = require('./TimerManager');\nconst { execSync } = require('child_process');\nconst { MongoClient } = require('mongodb');\nconst { Database } = require('quickmongo');\nconst { Manager } = require('erela.js');\nconst OpenEval = require('open-eval');\nconst glob = require('glob-promise');\nconst Turndown = require('turndown');\nconst snoowrap = require('snoowrap');\nconst BotList = require('./BotList');\nconst logger = require('./Logger');\nconst Redis = require('./Redis');\nconst web = require('../Web');\nconst path = require('path');\n\nmodule.exports = class Client extends CommandoClient {\n\tconstructor(options) {\n\t\tsuper({\n\t\t\tcommandPrefix: process.env.COMMAND_PREFIX,\n\t\t\towner: process.env.OWNER_ID,\n\t\t\tintents: [Intents.NON_PRIVILEGED, Intents.FLAGS.GUILDS],\n\t\t\tpartials: ['CHANNEL'],\n\t\t\tallowedMentions: {\n\t\t\t\trepliedUser: false,\n\t\t\t\tparse: ['roles', 'users'],\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\n\t\tthis.db = new Database(process.env.MONGO_URI, 'tanaka', {\n\t\t\tuseNewUrlParser: true,\n\t\t\tuseUnifiedTopology: true,\n\t\t});\n\n\t\tthis.logger = logger;\n\n\t\tthis.testWebhook = new WebhookClient(process.env.TEST_WEBHOOK_ID, process.env.TEST_WEBHOOK_TOKEN);\n\n\t\tthis.redis = new Redis(this).db;\n\n\t\tthis.timers = new TimerManager(this);\n\n\t\tthis.converter = new Turndown();\n\n\t\tthis.bl = new BotList(this);\n\n\t\tthis.client = this;\n\n\t\tthis.manager = new Manager({\n\t\t\tsend: (id, payload) => {\n\t\t\t\tconst guild = this.guilds.cache.get(id);\n\n\t\t\t\tif (guild) guild.shard.send(payload);\n\t\t\t},\n\t\t});\n\n\t\tthis.events = new Collection();\n\n\t\tthis.piston = new OpenEval();\n\n\t\tthis.reddit = new snoowrap({\n\t\t\tuserAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2869.0 Safari/537.36',\n\t\t\tclientId: process.env.REDDIT_CLIENT_ID,\n\t\t\tclientSecret: process.env.REDDIT_CLIENT_SECRET,\n\t\t\tusername: 'TomioCodes',\n\t\t\tpassword: process.env.REDDIT_PASSWORD,\n\t\t});\n\t}\n\n\tget ip() {\n\t\tconst ip = execSync('curl https://ipecho.net/plain', { timeout: 30000, encoding: 'utf-8' });\n\t\treturn ip;\n\t}\n\n\tget directory() {\n\t\treturn `${path.dirname(require.main.filename)}${path.sep}`;\n\t}\n\n\tasync userCount() {\n\t\tif (this.shard) {\n\t\t\tconst count = await this.shard.broadcastEval(\n\t\t\t\t'this.guilds.cache.reduce((a, b) => a + b.memberCount, 0)',\n\t\t\t);\n\n\t\t\treturn count.reduce((a, b) => a + b, 0);\n\t\t}\n\n\t\treturn this.guilds.cache.reduce((a, b) => a + b.memberCount, 0);\n\t}\n\n\tasync guildCount() {\n\t\tif (this.shard) {\n\t\t\tconst count = await this.shard.fetchClientValues('guilds.cache.size');\n\n\t\t\treturn count.reduce((a, b) => a + b, 0);\n\t\t}\n\n\t\treturn this.guilds.cache.size;\n\t}\n\n\tasync channelCount() {\n\t\tif (this.shard) {\n\t\t\tconst count = await this.shard.fetchClientValues('channels.cache.size');\n\n\t\t\treturn count.reduce((a, b) => a + b, 0);\n\t\t}\n\n\t\treturn this.channels.cache.size;\n\t}\n\n\tasync login(token = process.env.DISCORD_TOKEN) {\n\t\tthis.registerCommands();\n\t\tweb(this);\n\n\t\tawait this.loadEvents();\n\t\tawait this.registerProvider();\n\n\t\treturn super.login(token);\n\t}\n\n\tasync loadEvents() {\n\t\tconst events = await glob(`${this.directory}Events/**/*.js`);\n\n\t\tfor (const eventFile of events) {\n\t\t\tdelete require.cache[eventFile];\n\n\t\t\tconst File = require(eventFile);\n\t\t\tconst event = new File(this.client);\n\n\t\t\tthis.events.set(event.name, event);\n\t\t\tevent.emitter[event.type](event.name, (...args) => event.run(...args));\n\t\t}\n\t}\n\n\tgenerateCommandList() {\n\t\tconst list = this.registry.groups\n\t\t\t.map((g) => {\n\t\t\t\tconst commands = g.commands.filter((c) => !c.hidden);\n\t\t\t\treturn `\\n<h3>${g.name}:</h3>\\n\\n<ul>${commands\n\t\t\t\t\t.map((c) => {\n\t\t\t\t\t\tconst extra = `${c.ownerOnly ? ' (Owner-Only)' : ''}${\n\t\t\t\t\t\t\tc.nsfw ? ' (NSFW)' : ''\n\t\t\t\t\t\t}`;\n\t\t\t\t\t\treturn `<li> <strong>${c.name}:</strong> ${c.description}${extra}</li>`;\n\t\t\t\t\t})\n\t\t\t\t\t.join('</ul>\\n')}`;\n\t\t\t})\n\t\t\t.join('\\n');\n\n\t\treturn list;\n\t}\n\n\tregisterCommands() {\n\t\tthis.client.registry\n\t\t\t.registerDefaultTypes()\n\t\t\t.registerGroups([\n\t\t\t\t{ id: 'util', name: 'Utility', guarded: true },\n\t\t\t\t{ id: 'random', name: 'Random Response' },\n\t\t\t\t{ id: 'info', name: 'Information' },\n\t\t\t\t{ id: 'search', name: 'Search' },\n\t\t\t\t{ id: 'remind', name: 'Reminder' },\n\t\t\t\t{ id: 'anime-updates', name: 'Anime Updates' },\n\t\t\t\t{ id: 'codebin', name: 'Code Bins' },\n\t\t\t\t{ id: 'img', name: 'Image Manipulation' },\n\t\t\t\t{ id: 'music', name: 'Music' },\n\t\t\t\t{ id: 'nsfw', name: 'NSFW' },\n\t\t\t])\n\t\t\t.registerDefaultGroups()\n\t\t\t.registerDefaultCommands({\n\t\t\t\tunknownCommand: false,\n\t\t\t\thelp: false,\n\t\t\t\teval: false,\n\t\t\t\tping: false,\n\t\t\t\tcommandState: false,\n\t\t\t\tprefix: false,\n\t\t\t})\n\t\t\t.registerTypesIn(path.join(__dirname, '..', 'Types'))\n\t\t\t.registerCommandsIn(path.join(__dirname, '..', 'Commands'));\n\t}\n\n\tasync registerProvider() {\n\t\tconst mongo = await MongoClient.connect(process.env.MONGO_URI, {\n\t\t\tuseNewUrlParser: true,\n\t\t\tuseUnifiedTopology: true,\n\t\t});\n\n\t\tthis.setProvider(new MongoDBProvider(mongo, 'tanaka'));\n\t}\n};\n"]}